<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aufgabengestalter - Abi-Online</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- QR Code Bibliothek -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: { 850: '#1e293b', 900: '#0f172a' }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap');
        body { font-family: 'Inter', sans-serif; }
        /* QR Code Anpassung */
        #qrPreview img, #boardQRCode img { margin: 0 auto; }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 min-h-screen p-4 md:p-8 transition-colors duration-300 flex items-center justify-center">

    <div class="w-full max-w-4xl bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-200 dark:border-slate-700 p-6 md:p-8">
        
        <!-- Header -->
        <div class="flex justify-between items-start mb-8 border-b border-slate-100 dark:border-slate-700 pb-4">
            <div>
                <h1 class="text-2xl font-bold text-slate-800 dark:text-white flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-orange-500"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                    Aufgabengestalter
                </h1>
                <p class="text-slate-500 dark:text-slate-400 text-sm mt-1">Erstelle personalisierte Links und QR-Codes für Abi-Online.</p>
            </div>
            <a href="index.html" class="text-sm font-bold text-blue-600 hover:text-blue-700 hover:underline flex items-center gap-1">
                Zum Editor
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
            </a>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Linke Spalte: Formular -->
            <div class="lg:col-span-2 space-y-8">
                
                <!-- 1. Inhalt -->
                <div class="space-y-4">
                    <h3 class="text-xs font-bold uppercase tracking-widest text-slate-400 border-b border-slate-100 dark:border-slate-700 pb-1 mb-2">Inhalt & Vorgaben</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold mb-1">Name (Vorgabe)</label>
                            <input type="text" id="inpName" placeholder="z.B. Max Mustermann" class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-900 focus:ring-2 focus:ring-orange-500 outline-none transition-all" oninput="updateLink()">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-1">Klasse (Vorgabe)</label>
                            <input type="text" id="inpClass" placeholder="z.B. 10b" class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-900 focus:ring-2 focus:ring-orange-500 outline-none transition-all" oninput="updateLink()">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold mb-1">Aufgabentitel</label>
                        <input type="text" id="inpTitle" placeholder="z.B. Analyse von Faust" class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-900 focus:ring-2 focus:ring-orange-500 outline-none transition-all" oninput="updateLink()">
                    </div>

                    <div>
                        <label class="block text-sm font-semibold mb-1">Wortlimit (0 = deaktiviert)</label>
                        <div class="flex items-center gap-2">
                            <input type="number" id="inpLimit" value="0" min="0" step="50" class="w-32 px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-900 focus:ring-2 focus:ring-orange-500 outline-none transition-all" oninput="updateLink()">
                            <span class="text-xs text-slate-500">Wörter</span>
                        </div>
                    </div>
                </div>

                <!-- 2. Konfiguration -->
                <div>
                    <h3 class="text-xs font-bold uppercase tracking-widest text-slate-400 border-b border-slate-100 dark:border-slate-700 pb-1 mb-4">Ansicht & Funktionen</h3>
                    
                    <div class="grid grid-cols-2 sm:grid-cols-3 gap-3 bg-slate-50 dark:bg-slate-700/30 p-4 rounded-xl border border-slate-100 dark:border-slate-700">
                        <label class="flex items-center cursor-pointer group select-none">
                            <input type="checkbox" id="chkHeader" checked onchange="updateLink()" class="sr-only peer">
                            <div class="w-4 h-4 border-2 border-slate-300 rounded peer-checked:bg-orange-500 peer-checked:border-orange-500 flex items-center justify-center transition-colors mr-2">
                                <svg class="w-2.5 h-2.5 text-white hidden peer-checked:block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M5 13l4 4L19 7"></path></svg>
                            </div>
                            <span class="text-xs font-bold text-slate-600 dark:text-slate-300">Aufgabenkopf</span>
                        </label>

                        <label class="flex items-center cursor-pointer group select-none">
                            <input type="checkbox" id="chkPreview" checked onchange="updateLink()" class="sr-only peer">
                            <div class="w-4 h-4 border-2 border-slate-300 rounded peer-checked:bg-orange-500 peer-checked:border-orange-500 flex items-center justify-center transition-colors mr-2">
                                <svg class="w-2.5 h-2.5 text-white hidden peer-checked:block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M5 13l4 4L19 7"></path></svg>
                            </div>
                            <span class="text-xs font-bold text-slate-600 dark:text-slate-300">Mathe-Vorschau</span>
                        </label>

                        <label class="flex items-center cursor-pointer group select-none">
                            <input type="checkbox" id="chkCorrection" onchange="updateLink()" class="sr-only peer">
                            <div class="w-4 h-4 border-2 border-slate-300 rounded peer-checked:bg-orange-500 peer-checked:border-orange-500 flex items-center justify-center transition-colors mr-2">
                                <svg class="w-2.5 h-2.5 text-white hidden peer-checked:block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M5 13l4 4L19 7"></path></svg>
                            </div>
                            <span class="text-xs font-bold text-slate-600 dark:text-slate-300">Korrektur-Modus</span>
                        </label>

                        <label class="flex items-center cursor-pointer group select-none">
                            <input type="checkbox" id="chkAudio" onchange="updateLink()" class="sr-only peer">
                            <div class="w-4 h-4 border-2 border-slate-300 rounded peer-checked:bg-orange-500 peer-checked:border-orange-500 flex items-center justify-center transition-colors mr-2">
                                <svg class="w-2.5 h-2.5 text-white hidden peer-checked:block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M5 13l4 4L19 7"></path></svg>
                            </div>
                            <span class="text-xs font-bold text-slate-600 dark:text-slate-300">Audio / Vorlesen</span>
                        </label>

                        <label class="flex items-center cursor-pointer group select-none">
                            <input type="checkbox" id="chkExport" onchange="updateLink()" class="sr-only peer">
                            <div class="w-4 h-4 border-2 border-slate-300 rounded peer-checked:bg-orange-500 peer-checked:border-orange-500 flex items-center justify-center transition-colors mr-2">
                                <svg class="w-2.5 h-2.5 text-white hidden peer-checked:block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M5 13l4 4L19 7"></path></svg>
                            </div>
                            <span class="text-xs font-bold text-slate-600 dark:text-slate-300">Export-Menü</span>
                        </label>
                    </div>
                </div>

            </div>

            <!-- Rechte Spalte: QR & Output -->
            <div class="space-y-6">
                <!-- QR Code Box -->
                <div class="bg-white dark:bg-slate-700 p-4 rounded-xl border border-slate-200 dark:border-slate-600 flex flex-col items-center justify-center">
                    <div id="qrPreview" class="bg-white p-2 rounded"></div>
                    <p class="text-[10px] text-slate-400 mt-2 text-center uppercase tracking-widest font-bold">Live Vorschau</p>
                </div>

                <!-- Aktionen -->
                <div class="space-y-3">
                    <button onclick="openBoardView()" class="w-full bg-slate-800 hover:bg-slate-900 text-white p-3 rounded-lg font-bold shadow-lg transform hover:scale-[1.02] transition-all flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>
                        Tafel-Ansicht
                    </button>
                    
                    <div class="relative w-full">
                        <input type="text" id="resultLink" readonly class="w-full p-3 pr-10 bg-slate-100 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-lg text-xs font-mono text-slate-600 dark:text-slate-300 select-all focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="copyLink()" class="bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg font-bold transition-colors shadow-sm text-sm">
                            Link Kopieren
                        </button>
                        <a id="btnOpen" href="#" target="_blank" class="bg-slate-200 dark:bg-slate-600 hover:bg-slate-300 dark:hover:bg-slate-500 text-slate-800 dark:text-white py-2 rounded-lg font-bold flex items-center justify-center transition-colors shadow-sm text-sm">
                            Testen
                        </a>
                    </div>
                    
                    <div id="copyStatus" class="text-green-600 dark:text-green-400 text-xs font-bold text-center opacity-0 transition-opacity h-4">
                        In Zwischenablage kopiert!
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- TAFEL ANSICHT MODAL -->
    <div id="boardModal" class="fixed inset-0 bg-slate-900 z-[200] hidden flex-col items-center justify-center text-white p-4 animate-in fade-in duration-300">
        <button onclick="closeBoard()" class="absolute top-6 right-6 text-slate-400 hover:text-white transition-colors bg-slate-800/50 p-2 rounded-full">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        </button>
        
        <div class="text-center space-y-8 max-w-5xl w-full">
            <div class="space-y-2">
               <h3 class="text-xl md:text-2xl font-bold text-slate-400 uppercase tracking-widest">Abi-Online Aufgabe</h3>
               <h2 id="boardTitle" class="text-4xl md:text-6xl font-extrabold text-orange-500 leading-tight"></h2>
            </div>
            
            <div class="bg-white p-6 md:p-10 rounded-3xl inline-block shadow-2xl mx-auto">
               <div id="boardQRCode"></div>
            </div>
            
            <div class="bg-slate-800/80 p-6 rounded-xl border border-slate-700 backdrop-blur-sm">
                <p class="text-lg text-slate-400 mb-2">Scanne den Code oder nutze den Link:</p>
                <div class="text-xl md:text-3xl font-mono text-blue-300 break-all select-all" id="boardLink"></div>
            </div>
        </div>
    </div>

    <script>
        let currentUrl = "";

        function updateLink() {
            let baseUrl = window.location.href.replace('aufgabengestalter.html', 'index.html');
            if(baseUrl === window.location.href) baseUrl = './index.html';

            const params = new URLSearchParams();
            const val = (id) => document.getElementById(id).value.trim();
            const isChecked = (id) => document.getElementById(id).checked;

            if(val('inpName')) params.append('name', val('inpName'));
            if(val('inpClass')) params.append('klasse', val('inpClass'));
            if(val('inpTitle')) params.append('titel', val('inpTitle'));
            
            const limit = val('inpLimit');
            if(limit && limit !== '0') params.append('limit', limit);

            params.append('header', isChecked('chkHeader'));
            params.append('preview', isChecked('chkPreview'));
            params.append('correction', isChecked('chkCorrection'));
            params.append('audio', isChecked('chkAudio'));
            params.append('export', isChecked('chkExport'));

            currentUrl = baseUrl + '?' + params.toString();
            
            // Updates
            document.getElementById('resultLink').value = currentUrl;
            document.getElementById('btnOpen').href = currentUrl;
            
            // QR Code Rendering
            renderQR('qrPreview', 128); // Kleine Vorschau
        }

        function renderQR(containerId, size) {
            const container = document.getElementById(containerId);
            container.innerHTML = ''; // Clear
            if(typeof QRCode !== 'undefined') {
                new QRCode(container, {
                    text: currentUrl,
                    width: size,
                    height: size,
                    colorDark : "#000000",
                    colorLight : "#ffffff",
                    correctLevel : QRCode.CorrectLevel.H
                });
            } else {
                container.textContent = "QR Lib lädt...";
            }
        }

        // --- Tafel Ansicht Logik ---
        function openBoardView() {
            const title = document.getElementById('inpTitle').value.trim() || "Aufgabe";
            document.getElementById('boardTitle').textContent = title;
            document.getElementById('boardLink').textContent = currentUrl;
            
            const modal = document.getElementById('boardModal');
            modal.style.display = 'flex';
            
            // QR Code groß rendern (verzögert für DOM Layout)
            setTimeout(() => {
                renderQR('boardQRCode', 300);
            }, 50);
        }

        function closeBoard() {
            document.getElementById('boardModal').style.display = 'none';
        }

        function copyLink() {
            const linkField = document.getElementById('resultLink');
            linkField.select();
            try {
                navigator.clipboard.writeText(linkField.value).then(() => showSuccess());
            } catch(e) {
                document.execCommand('copy');
                showSuccess();
            }
        }

        function showSuccess() {
            const status = document.getElementById('copyStatus');
            status.style.opacity = '1';
            setTimeout(() => status.style.opacity = '0', 3000);
        }

        // Init
        window.onload = updateLink;
    </script>
</body>
</html>